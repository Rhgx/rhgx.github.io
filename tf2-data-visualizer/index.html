<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="color-scheme" content="light" />

  <meta property="og:title" content="TF2 Match Data Visualizer" />
  <meta property="og:description" content="Upload TF2 match CSVs to visualize the data onto charts." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#b44c33">
  <meta property="og:url" content="https://rhgx.github.io/tf2-data-visualizer" />
  <meta property="og:site_name" content="TF2 Match Data Visualizer" />

  <title>Match Data Visualizer</title>

  <!-- Remix Icon -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">

  <!-- Chart.js + GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- App styles -->
  <link rel="stylesheet" href="./styles/index.css" />
</head>

<body>
  <div id="app" class="container">
    <!-- Header -->
    <header class="site-header">
      <div class="header-content">
        <h1 class="site-title"><img src="./images/logo.svg" alt="" class="title-logo"> Match Data Visualizer</h1>

        <div class="header-controls">
          <!-- Tabs -->
          <nav id="tab-nav" class="tab-nav hidden" role="tablist">
            <div id="tab-indicator" class="tab-indicator"></div>
            <button id="tab-general" class="tab-btn active" role="tab" aria-controls="general-app" aria-selected="true">
              General Data
            </button>
            <button id="tab-tf2" class="tab-btn" role="tab" aria-controls="tf2-app" aria-selected="false">
              Map History
            </button>
            <button id="tab-lists" class="tab-btn" role="tab" aria-controls="lists-app" aria-selected="false">
              Top Lists
            </button>
          </nav>

          <!-- Clear data button -->
          <button id="clear-data" class="btn btn-secondary hidden" title="Clear current data and upload a new file">
            Clear Data
          </button>
        </div>
      </div>
    </header>

    <!-- Global Upload Section -->
    <section id="global-upload" class="upload-zone" tabindex="0" role="button" aria-label="Upload CSV file">
      <i class="ri-upload-cloud-2-line upload-icon"></i>
      <label for="global-file-input" class="upload-label">
        Select CSV File
      </label>
      <input type="file" id="global-file-input" class="hidden" accept=".csv" />
      <p class="upload-hint">Drag & drop your CSV file here, or click to browse.</p>
    </section>

    <!-- Help Button -->
    <button id="help-trigger" class="help-link" type="button">
      <i class="ri-question-line"></i> How do I get my data?
    </button>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay hidden" role="dialog" aria-modal="true"
      aria-labelledby="help-modal-title">
      <div class="modal-content">
        <button id="help-modal-close" class="modal-close" aria-label="Close">&times;</button>
        <h2 id="help-modal-title" class="modal-title">How to Get Your TF2 Match Data</h2>
        <ol class="guide-steps">
          <li><strong>Open Steam</strong> in your web browser (not the Steam app)</li>
          <li><strong>Go to your Match History:</strong><br>
            <a href="https://steamcommunity.com/my/gcpd/440/?tab=playermatchhistory" target="_blank" rel="noopener"
              class="guide-link">
              steamcommunity.com/my/gcpd/440
            </a>
          </li>
          <li><strong>Open Developer Tools</strong> — Press <kbd>F12</kbd>, then click the <strong>Console</strong> tab
          </li>
          <li><strong>Copy the script</strong> using the button below and paste it into the console</li>
          <li><strong>Press Enter</strong> and wait for the download to complete</li>
          <li><strong>Upload the CSV</strong> file back here</li>
        </ol>
        <button id="copy-script-btn" class="btn btn-primary copy-btn">
          <i class="ri-file-copy-line"></i> Copy Script to Clipboard
        </button>
      </div>
    </div>

    <!-- Global Loading -->
    <div id="global-loading" class="loading-container hidden" aria-live="polite">
      <div class="loading-spinner"></div>
      <p class="loading-text">Processing data…</p>
    </div>

    <!-- ════════════════════════════════════════════════════════════════════ -->
    <!-- GENERAL DATA VISUALIZER -->
    <!-- ════════════════════════════════════════════════════════════════════ -->
    <section id="general-app" class="hidden space-y-lg" role="tabpanel" aria-labelledby="tab-general">
      <main id="g-dashboard" class="space-y-lg">

        <!-- Key Stats -->
        <section id="g-key-stats" class="stat-grid" aria-live="polite"></section>

        <!-- Filters -->
        <section class="filter-bar">
          <div class="filter-group">
            <label for="g-sort-select" class="filter-label">Match</label>
            <select id="g-sort-select" class="filter-select"></select>
          </div>

          <div class="filter-group">
            <label for="g-type-filter" class="filter-label">Type</label>
            <select id="g-type-filter" class="filter-select"></select>
          </div>

          <div class="filter-group">
            <i class="ri-search-line" style="color: var(--steel);"></i>
            <input type="text" id="g-match-search" placeholder="Search..." class="filter-input" style="width: 140px;" />
          </div>

          <button id="g-clear-search" type="button" class="btn btn-ghost" title="Clear search">
            Clear
          </button>
          <button id="g-reset-filters" type="button" class="btn btn-primary" title="Reset all filters">
            Reset Filters
          </button>
        </section>

        <!-- Charts -->
        <section class="chart-grid">
          <div class="chart-container">
            <h2 class="chart-title">Performance Overview</h2>
            <div class="chart-wrapper">
              <canvas id="g-performance-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h2 class="chart-title">Win / Loss Breakdown</h2>
            <div class="chart-wrapper">
              <canvas id="g-win-loss-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h2 class="chart-title">Game Modes Played</h2>
            <div class="chart-wrapper">
              <canvas id="g-game-mode-chart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h2 class="chart-title">Performance Over Time (Last 200)</h2>
            <div class="chart-wrapper">
              <canvas id="g-timeline-chart"></canvas>
            </div>
          </div>
        </section>

        <!-- Raw Data Table -->
        <section class="section-panel">
          <div class="section-header">
            <h2 class="section-title">Raw Match Data</h2>
            <div id="g-table-summary" class="table-summary"></div>
          </div>
          <div id="g-data-table-container" class="table-wrapper" role="region" aria-label="Raw match data table"></div>
        </section>
      </main>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════ -->
    <!-- TF2 MAP HISTORY -->
    <!-- ════════════════════════════════════════════════════════════════════ -->
    <section id="tf2-app" class="hidden space-y-lg" role="tabpanel" aria-labelledby="tab-tf2">
      <div id="t-visualization" class="hidden space-y-lg">

        <!-- Controls -->
        <div class="section-panel">
          <div class="section-header">
            <h2 class="section-title">Your Map Play History</h2>
            <div class="section-controls">
              <div class="filter-group" title="How many maps to show in the chart">
                <label for="t-top-n" class="filter-label">Top</label>
                <select id="t-top-n" class="filter-select">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="30">30</option>
                  <option value="50">50</option>
                  <option value="all">All</option>
                </select>
              </div>

              <div class="filter-group" title="Sort order for the table">
                <label for="t-sort" class="filter-label">Sort</label>
                <select id="t-sort" class="filter-select">
                  <option value="countDesc" selected>Count ↓</option>
                  <option value="countAsc">Count ↑</option>
                  <option value="alphaAsc">Name A→Z</option>
                  <option value="alphaDesc">Name Z→A</option>
                </select>
              </div>

              <div class="filter-group" title="Filter chart by name">
                <i class="ri-search-line" style="color: var(--steel);"></i>
                <input id="t-chart-search" type="text" placeholder="Filter chart…" class="filter-input"
                  style="width: 120px;" />
              </div>

              <button id="t-download" class="btn btn-primary">
                <i class="ri-download-line"></i> Download
              </button>
              <button id="t-reset" class="btn btn-secondary">
                Reset
              </button>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stat-grid" style="margin-bottom: var(--space-lg);">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="ri-bar-chart-box-fill"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">Total Matches</div>
                <div id="t-total" class="stat-value">0</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">
                <i class="ri-map-2-fill"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">Unique Maps</div>
                <div id="t-unique" class="stat-value">0</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">
                <i class="ri-star-fill"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">Most Played</div>
                <div id="t-most" class="stat-value" style="font-size: 1rem;">-</div>
              </div>
            </div>
          </div>

          <!-- Chart -->
          <div class="chart-container" style="border: none; box-shadow: none; padding: 0;">
            <div class="chart-wrapper" style="height: 400px;">
              <canvas id="t-map-chart"></canvas>
            </div>
          </div>
        </div>

        <!-- Map Details Table -->
        <div class="section-panel">
          <div class="section-header">
            <h3 class="section-title">Map Details</h3>
            <div class="section-controls">
              <div class="filter-group" title="Search within the Map Details table">
                <i class="ri-search-line" style="color: var(--steel);"></i>
                <input id="t-table-search" type="text" placeholder="Search table…" class="filter-input"
                  style="width: 140px;" />
              </div>
              <div id="t-table-summary" class="table-summary" aria-live="polite"></div>
            </div>
          </div>

          <div id="t-table-container" class="table-wrapper" role="region" aria-label="Map details table"></div>

          <!-- Empty state -->
          <div id="t-empty" class="empty-state hidden">
            <div class="empty-icon">
              <i class="ri-error-warning-line" style="font-size: 2.5rem; color: var(--steel);"></i>
            </div>
            <h3 class="empty-title">No map data found</h3>
            <p class="empty-text">
              The CSV doesn't contain a "map_index" column or it's empty.
              Please verify your export and try again.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════ -->
    <!-- TOP LISTS -->
    <!-- ════════════════════════════════════════════════════════════════════ -->
    <section id="lists-app" class="hidden space-y-lg" role="tabpanel" aria-labelledby="tab-lists">
      <div class="section-panel">
        <div class="section-header">
          <h2 class="section-title">Top Lists</h2>
          <div class="section-controls">
            <div class="filter-group" title="Select a metric to rank matches">
              <label for="l-metric" class="filter-label">Metric</label>
              <select id="l-metric" class="filter-select">
                <option value="kills" selected>Most Kills</option>
                <option value="deaths">Most Deaths</option>
                <option value="damage">Most Damage</option>
                <option value="healing">Most Healing</option>
                <option value="match_duration">Longest Match</option>
                <option value="time_in_queue">Longest Queue</option>
                <option value="support">Most Support</option>
              </select>
            </div>

            <div class="filter-group" title="Sort order">
              <label for="l-order" class="filter-label">Order</label>
              <select id="l-order" class="filter-select">
                <option value="desc" selected>Descending</option>
                <option value="asc">Ascending</option>
              </select>
            </div>

            <div class="filter-group" title="Filter by game type">
              <label for="l-type" class="filter-label">Type</label>
              <select id="l-type" class="filter-select">
                <option value="all" selected>All Types</option>
              </select>
            </div>

            <div class="filter-group" title="Search matches">
              <i class="ri-search-line" style="color: var(--steel);"></i>
              <input id="l-search" type="text" placeholder="Search…" class="filter-input" style="width: 120px;" />
            </div>

            <button id="l-reset" class="btn btn-secondary">
              Reset
            </button>
          </div>
        </div>
      </div>

      <div class="section-panel">
        <div class="section-header">
          <h3 class="section-title">Matches</h3>
          <div id="l-summary" class="table-summary"></div>
        </div>
        <div id="l-table-container" class="table-wrapper" role="region" aria-label="Top list table"></div>
      </div>
    </section>
  </div>

  <!-- App bootstrap -->
  <script type="module" src="./modules/ui.js"></script>
</body>

</html>