<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TC2 Loadout Generator</title>
  <meta content="TC2 Loadout Generator" property="og:title" />
  <meta content="A loadout generator for the Roblox game 'Typical Colors 2'." property="og:description" />
  <meta content="https://rhgx.github.io/tc2-loadout-generator" property="og:url" />
  <meta content="https://i.imgur.com/YoAihg6.png" property="og:image" />
  <meta content="#2ac94f" data-react-helmet="true" name="theme-color" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap">
  <style>
   body {
      font-family: 'Oswald', sans-serif;
      background-color: #383838;
      color: #e0e0e0;
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      background-position: center center;
    }

    .class-icon {
      width: 100%;
      height: auto;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      border-radius: 5px;
    }

    .selected {
      border-color: #FFD700;
      box-shadow: 
        0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 215, 0, 0.3),
        0 0 30px rgba(255, 215, 0, 0.1),
        inset 0 0 5px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
    }

    .loadout-container {
      display: none;
      background-color: #1e1e1e;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .loadout-container.show {
      opacity: 1;
    }

    .item-container {
      text-align: center;
      color: #FFD700;
      font-size: 25px;
      background-color: #333333;
      width: 100%;
      max-width: 300px;
      margin: 10px auto;
      border-radius: 10px;
      padding: 10px;
      transition: all 0.3s ease-in-out;
    }

    .item-container.changing {
      transform: scale(0.95);
      opacity: 0;
    }

    .class-portrait {
      width: 100%;
      height: auto;
      max-width: 100%;
      margin: auto;
      -webkit-filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      transition: all 0.3s ease-in-out;
    }

    .class-portrait.changing {
      transform: scale(0.95);
      opacity: 0;
    }

    .btn-gen {
      font-size: 35px;
    }

    .btn-dark {
      background-color: #333333;
      border: none;
      transition: all 0.3s ease;
      border-radius: 8px;
    }

    .btn-dark:hover {
      background-color: #444444;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1 {
      -webkit-text-fill-color: #fff;
      -webkit-text-stroke-width: 1.5px;
      -webkit-text-stroke-color: #1f1f1f;
    }

    .class-container {
      display: flex;
      justify-content: center;
      background-color: #1e1e1e;
      padding: 20px;
      max-width: 1000px;
      border-radius: 10px;
      margin: auto;
    }

    .class-container-wrapper {
      display: flex;
      justify-content: center;
    }

    .class-icons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-gap: 10px;
      max-width: 700px;
      margin: auto;
    }

    .class-icons button {
      flex: 1 0 20%;
      max-width: 100px;
      margin: 5px;
      padding: 5px;
    }

    .col {
      width: 100%;
      margin: auto
    }

    .portrait {
      background-color: #333333;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 600px;
      margin: auto;
    }

    .item-container img {
      max-width: 100px;
      -webkit-filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      height: auto;
    }

    .class-name {
      color: #e0e0e0;
      font-size: 40px;
      text-align: center;
      margin-top: 20px;
    }

    .credits {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 20px;
      color: white;
      text-align: left;
      line-height: 1.6;
      z-index: 2;
    }

    /* Update loading indicator styles */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .loading-content {
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .loading-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    #loading-progress {
      color: white;
      font-size: 18px;
      margin-top: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Accessibility improvements */
    .btn:focus {
      outline: 3px solid #2ac94f;
      outline-offset: 2px;
    }

    /* Add hover effects */
    .class-icon:hover {
      transform: scale(1.1);
      transition: transform 0.2s ease;
    }

    .experimental-btn {
      position: fixed;
      right: 10px;
      bottom: 10px;
      background-color: #333333;
      border: 2px solid #69d732;
      color: #69d732;
      padding: 8px 16px;
      font-size: 18px;
      border-radius: 8px;
      transition: all 0.3s ease;
      z-index: 2;
    }

    .experimental-btn:hover {
      background-color: #69d732;
      color: #333333;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(105, 215, 50, 0.3);
    }
  </style>
</head>

<body>
  <!-- <a href="experimental" class="btn experimental-btn">Experimental Weapons</a> -->

  <div class="credits">
    Site : Rocks<br>
    Class Portraits : Alyssa<br>
    Weapon Icons : TC2 Wiki 
  </div>
  <div class="container py-5">
    <h1 class="text-center mb-4">TC2 Random Loadout Generator</h1>
    <div class="class-container-wrapper">
    <div class="class-container mb-4">
      <div class="class-icons">
        <button class="btn btn-dark"><img class="class-icon" id="Flanker"
            src="images/icons/flankertransparent.png" alt="Flanker" draggable="false"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Trooper"
            src="images/icons/troopertransparent.png" alt="Trooper" draggable="false"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Arsonist"
            src="images/icons/arsonisttransparent.png" alt="Arsonist" draggable="false"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Annihilator" draggable="false"
            src="images/icons/annihilatortransparent.png"
            alt="Annihilator"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Brute" draggable="false"
            src="images/icons/brutetransparent.png" alt="Brute"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Mechanic" draggable="false"
            src="images/icons/mechanictransparent.png" alt="Mechanic"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Doctor" draggable="false"
            src="images/icons/doctortransparent.png" alt="Doctor"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Marksman" draggable="false"
            src="images/icons/marksmantransparent.png" alt="Marksman"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Agent" draggable="false"
            src="images/icons/agenttransparent.png" alt="Agent"></button>
        <button class="btn btn-dark"><img class="class-icon" id="Random" draggable="false" src="images/questionClass.png"
            alt="Random"></button>
       </div>
      </div>
    </div>
    <div class="text-center mb-4">
      <button id="generate" class="btn btn-success btn-gen">Generate</button>
    </div>
    <div id="loadout" class="loadout-container">
      <p id="className" class="class-name"></p>
      <div class="row">
        <div class="col">
          <div class="portrait">
            <img id="classPortrait" class="class-portrait" src="" alt="" draggable="false">
          </div>
        </div>
        <div class="col">
          <div class="item-container" id="primaryWeapon">
            <img src="" alt="" draggable="false">
            <p></p>
          </div>
          <div class="item-container" id="secondaryWeapon">
            <img src="" alt="" draggable="false">
            <p></p>
          </div>
          <div class="item-container" id="meleeWeapon">
            <img src="" alt="" draggable="false">
            <p></p>
          </div>
          <div class="item-container" id="pda">
            <img src="" alt="" draggable="false">
            <p></p>
          </div>
        </div>
      </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
    <script>
      const classPortraits = {
        "Flanker": "images/portraits_stare/flankerstare.png",
        "Trooper": "images/portraits_stare/trooperstare.png",
        "Arsonist": "images/portraits_stare/arsoniststare.png",
        "Annihilator": "images/portraits_stare/annihilatorstare.png",
        "Brute": "images/portraits_stare/brutestare.png",
        "Mechanic": "images/portraits_stare/mechanicstare.png",
        "Doctor": "images/portraits_stare/doctorstare.png",
        "Marksman": "images/portraits_stare/marksmanstare.png",
        "Agent": "images/portraits_stare/agentstare.png"
      };

      const weapons = {
        "Flanker": {
          "Primary": ["Lever Shotgun", "Baby Face's Blaster", "Lupara DB", "Soda Popper", "Perceptionist", "Colbat", "Shotgun Cannon", "Specialist"],
          "Secondary": ["Pistol", "Concealed Carry", "Conventional", "Winger", "Batarang", "Bloxy Cola", "Witches Brew", "Mad Milk", "Super Sneakers"],
          "Melee": ["Bat", "Holy Mackerel", "Atomizer", "Brooklyn Basher", "Candy Cane", "Cold Shoulder", "Grill Scout", "Sandman", "Wooden Sword", "Wrap Assassin"]
        },
        "Trooper": {
          "Primary": ["Rocket Launcher", "Original", "RE:COIL", "Direct Hit", "Double Trouble", "G-Bomb", "Liberty Launcher", "Maverick", "Rocket Jumper", "Wrecker's Yard", "Friendly Fire Foiler", "Stellar Carpet", "Great Unifier"],
          "Secondary": ["Shotgun", "Bullet-stormer", "Crankestein", "Deathblow", "Family Business", "Reserve Shooter", "Boonie Blaster", "Personal Death Ray", "Battalion's Backup", "Buff Banner", "Concheror", "Parabomber", "Gunboats", "Manthreads"],
          "Melee": ["Crowbar", "Slapjock!", "Equalizer", "Escape Plan", "Furious Flagxe", "Katana", "Market Gardener", "Tunnel Rat"]
        },
        "Arsonist": {
          "Primary": ["Flamethrower", "Degreaser", "Interceptor", "Phlogistinator", "HuangLong's Wrath"],
          "Secondary": ["Shotgun", "Bullet-stormer", "Crankestein", "Deathblow", "Family Business", "Detonator", "Flare Gun"],
          "Melee": ["Fire Extinguisher", "Thousand Degree Axe", "Escapist's Escapade", "Hotwire", "Improvised Inovator", "Mending Mallet"]
        },
        "Annihilator": {
          "Primary": ["Grenade Launcher", "M1 Garandier", "Iron Force", "Loose Canon", "Acid Trader", "Parabomber", "Gunboats", "Galway Greaves", "Squire Boots"],
          "Secondary": ["Stickybomb Launcher", "Irish Guard", "Quickiebomb Launcher", "Sticky Jumper", "Bloody Bracer", "Chargin' Targe", "Gladiators Guard", "Ragin' Bull", "Tide Turner"],
          "Melee": ["Broken Sword", "Battle Axe", "Black Death", "Elegant Blade", "Furious Flagxe", "Golf Club", "Katana", "Shock and Awe", "Spartan Warrior"]
        },
        "Brute": {
          "Primary": ["Minigun", "Biker's Blitz", "First Responder", "M249", "Maxine", "Tomislav"],
          "Secondary": ["Shotgun", "Bullet-stormer", "Crankestein", "Deathblow", "Family Business", "Sub Shotgun", "Battle Burrito", "Brash Burger", "Dire Donut", "ROBAR", "Special-Ops Sushi", "Tenacious Turkey"],
          "Melee": ["Fists", "Boxing Gloves", "Eviction Notice", "Gravity Coil", "Fists of Steel", "Speed Coil", "Warrior's Spririt"]
        },
        "Mechanic": {
          "Primary": ["Shotgun", "Bullet-stormer", "Crankestein", "Family Business", "Avengeance", "Einsteinium", "Gutbuster", "Rescue Ranger", "Widowmaker"],
          "Secondary": ["Pistol", "Conventional", "Noisy Cricket", "Short Circuit", "Wrangler", "Heavy Metal"],
          "Melee": ["Wrench", "Eureka Effect", "Gunslinger", "P.D.Q", "Southern Hospitality"]
        },
        "Doctor": {
          "Primary": ["Syringe Crossbow", "Syringe SMG", "Dairy Douser", "Mercy Kill", "Overdrive"],
          "Secondary": ["Medigun", "Blood Doctor", "Kritzkrieg", "Rejuvenator", "Vaccinator"],
          "Melee": ["Saw", "Amputator", "Dentist's Delight", "Pestilence Poker", "Supersaw"]
        },
        "Marksman": {
          "Primary": ["Sniper Rifle", "Classic", "Efficient Eliminator", "Huntsman", "Model IV", "Poacher's Pride", "Skullbuster", "Sour Shots", "Urban Upriser"],
          "Secondary": ["MAC-10", "50-AE", "Suppressed Solution", "Lemonade", "Hermits' Haversack", "Razorback", "Turtle Rock"],
          "Melee": ["Machete", "Gustabe", "Camper's Climber", "Mischievous Machete", "Lemoblade"]
        },
        "Agent": {
          "Primary": ["Revolver", "Diavolo", "Block-17", "Cloak Revolver", "Quick Draw", "Silenced Pistol", "Sinister Suit"],
          "Secondary": ["Invis-Watch", "Cloak and Dagger", "Dead Ringer", "Afterimage"],
          "Melee": ["Knife", "Conniver's Kunai", "Icicle", "Swift Stiletto", "Your Eternal Reward", "Wraith"],
          "PDA": ["Sapper", "Slow Burn", "Stray Reflex", "Radius Scanner", "Spy Camera"]
        }
      };

      let selectedClass = null;

      const button = document.getElementById('generate');

      document.querySelectorAll('.class-icon').forEach(icon => {
        icon.addEventListener('click', () => {
          document.querySelectorAll('.class-icon').forEach(icon => icon.classList.remove('selected'));
          icon.classList.add('selected');
          selectedClass = icon.id;
        });
      });

      function throttle(func, limit) {
        let inThrottle;
        return function(...args) {
          if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        }
      }
      
      function sanitizeName(name) {
          return name
          .toLowerCase().
          replace(/ /g, '-')
          .replace(/[^a-z0-9-]/g, '');
      }

      class ImagePreloader {
        constructor() {
          this.loaded = 0;
          this.total = 0;
          this.cache = new Map();
        }

        async preloadImages(urls) {
          this.total = urls.size;
          const loadingOverlay = this.createLoadingOverlay();
          document.body.appendChild(loadingOverlay);

          try {
            const promises = Array.from(urls).map(url => this.preloadImage(url));
            await Promise.allSettled(promises);
          } finally {
            if (document.body.contains(loadingOverlay)) {
                loadingOverlay.remove();
            }
          }
        }

        preloadImage(url) {
          if (this.cache.has(url)) return Promise.resolve();
          return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => {
              this.cache.set(url, img);
              this.loaded++;
              this.updateLoadingProgress();
              resolve();
            };
            img.onerror = () => {
              console.warn(`Failed to load image: ${url}`);
              this.loaded++;
              this.updateLoadingProgress();
              reject();
            };
            img.src = url;
          });
        }

        createLoadingOverlay() {
          const overlay = document.createElement('div');
          overlay.className = 'loading-overlay';
          overlay.innerHTML = `
            <div class="loading-content">
              <div class="loading-spinner"></div>
              <div id="loading-progress">Loading assets... (0%)</div>
            </div>`;
          return overlay;
        }

        updateLoadingProgress() {
          const progress = document.getElementById('loading-progress');
          if (progress) {
            const percentage = this.total > 0 ? Math.round((this.loaded / this.total) * 100) : 100;
            progress.textContent = `Loading assets... (${percentage}%)`;
          }
        }
      }

      function generateLoadout(currentClass) {
        const loadoutContainer = document.getElementById('loadout');
        const itemContainers = document.querySelectorAll('.item-container');
        const classPortrait = document.getElementById('classPortrait');
        
        const previousClass = classPortrait.dataset.currentClass;
        classPortrait.dataset.currentClass = currentClass;

        const animateElements = () => {
          itemContainers.forEach(container => container.classList.add('changing'));
          if (previousClass !== currentClass) classPortrait.classList.add('changing');
        };

        const updateLoadout = () => {
          document.getElementById('className').textContent = `Your loadout for ${currentClass} is..`;
          classPortrait.src = classPortraits[currentClass];

          const setWeapon = (slotType, weaponList) => {
              const container = document.getElementById(`${slotType.toLowerCase()}Weapon`);
              const weaponName = weaponList[Math.floor(Math.random() * weaponList.length)];
              const weaponImage = `images/weapons/${sanitizeName(currentClass)}/${sanitizeName(weaponName)}.png`;
              
              container.querySelector('img').src = weaponImage;
              container.querySelector('p').textContent = weaponName;
          };

          setWeapon('primary', weapons[currentClass]['Primary']);
          setWeapon('secondary', weapons[currentClass]['Secondary']);
          setWeapon('melee', weapons[currentClass]['Melee']);

          const pdaContainer = document.getElementById('pda');
          if (currentClass === "Agent" && weapons[currentClass]["PDA"]) {
            pdaContainer.style.display = 'block';
            const pdaName = weapons[currentClass]["PDA"][Math.floor(Math.random() * weapons[currentClass]["PDA"].length)];
            const pdaImage = `images/weapons/agent/${sanitizeName(pdaName)}.png`;
            pdaContainer.querySelector('img').src = pdaImage;
            pdaContainer.querySelector('p').textContent = pdaName;
          } else {
            pdaContainer.style.display = 'none';
          }
        };

        animateElements();
        loadoutContainer.style.display = 'block';
        setTimeout(() => {
          loadoutContainer.classList.add('show');
          updateLoadout();
          setTimeout(() => {
            itemContainers.forEach(container => container.classList.remove('changing'));
            if (previousClass !== currentClass) classPortrait.classList.remove('changing');
          }, 50);
        }, 300);
      }

      document.addEventListener("DOMContentLoaded", async function () {
        const preloader = new ImagePreloader();
        const imagesToPreload = new Set();

        const backgrounds = [
          "3cp_citrus",
          "ad_cliffhanger",
          "ad_deadfall_ridge",
          "ad_gorge",
          "ad_yellowvalley",
          "ctf_doublefort",
          "koth_bagel",
          "koth_harvest",
          "tr_target"
        ];
        const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
        const bgPath = `images/backgrounds/${randomBg}.png`;
        document.body.style.backgroundImage = `url('${bgPath}')`;
        imagesToPreload.add(bgPath);

        // Preload all existing images
        document.querySelectorAll('img').forEach(img => {
          if (img.src) imagesToPreload.add(img.src);
        });
        document.querySelectorAll('*').forEach(element => {
          const bgImg = window.getComputedStyle(element).backgroundImage;
          if (bgImg.startsWith('url')) {
            const url = bgImg.match(/url\(['"]?(.*?)['"]?\)/)?.[1];
            if (url) imagesToPreload.add(url);
          }
        });

        for (const className in weapons) {
            const saneClassName = sanitizeName(className);
            for (const weaponType in weapons[className]) {
                weapons[className][weaponType].forEach(weaponName => {
                    const localPath = `images/weapons/${saneClassName}/${sanitizeName(weaponName)}.png`;
                    imagesToPreload.add(localPath);
                });
            }
        }
        Object.values(classPortraits).forEach(portraitUrl => imagesToPreload.add(portraitUrl));

        await preloader.preloadImages(imagesToPreload);

        const throttledGenerate = throttle(() => {
          let currentClass = selectedClass;
          if (!currentClass) {
              alert("Please select a class first!");
              return;
          }
          if (currentClass === "Random") {
            const classKeys = Object.keys(classPortraits);
            currentClass = classKeys[Math.floor(Math.random() * classKeys.length)];
          }
          generateLoadout(currentClass);
          document.getElementById('loadout').scrollIntoView({ behavior: 'smooth' });
        }, 500);

        button.addEventListener('click', throttledGenerate);
        
        function handleArrowKeys(e) {
          if (!['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.code)) return;
          
          const icons = Array.from(document.querySelectorAll('.class-icon'));
          const selectedIcon = document.querySelector('.class-icon.selected');
          let currentIndex = selectedIcon ? icons.indexOf(selectedIcon) : -1;
          
          let newIndex = 0;
          const gridWidth = 5;
          const numIcons = icons.length;
          
          if(currentIndex === -1) {
            newIndex = 0;
          } else {
            switch(e.code) {
              case 'ArrowLeft':
                newIndex = currentIndex > 0 ? currentIndex - 1 : numIcons - 1;
                break;
              case 'ArrowRight':
                newIndex = currentIndex < numIcons - 1 ? currentIndex + 1 : 0;
                break;
              case 'ArrowUp':
                newIndex = currentIndex < gridWidth ? (numIcons + currentIndex - gridWidth) % numIcons : currentIndex - gridWidth;
                break;
              case 'ArrowDown':
                newIndex = (currentIndex + gridWidth) % numIcons;
                break;
            }
          }
          
          icons.forEach(icon => icon.classList.remove('selected'));
          icons[newIndex].classList.add('selected');
          selectedClass = icons[newIndex].id;
          
          e.preventDefault();
        }

        document.addEventListener('keydown', (e) => {
          if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.code)) {
            handleArrowKeys(e);
          } else if (e.code === 'Space' || e.code === 'Enter') {
            e.preventDefault();
            throttledGenerate();
          }
        });
      });
    </script>
</body>
</html>